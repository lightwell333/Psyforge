<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>PsyForge — A/B Visual Mixer (No Cam)</title>
<style>
  :root{--glass:rgba(16,16,22,.86);--fg:#eaf4ff;--muted:#b9c5db;--line:#2a3246;--accent:#77f0ff;--danger:#ff6b6b}
  html,body{margin:0;height:100%;background:#000;color:var(--fg);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  canvas{display:block;width:100vw;height:100vh;touch-action:none;cursor:grab;background:#000}
  #dock{position:fixed;left:50%;top:10px;transform:translateX(-50%);z-index:50;background:var(--glass);border:1px solid var(--line);
        border-radius:16px;padding:0;backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(0,0,0,.35);max-width:96vw;max-height:82vh;overflow:auto}
  #dragbar{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 10px;background:rgba(8,10,16,.9);
           border-bottom:1px solid var(--line);cursor:grab;user-select:none}
  #dragbar .grab{display:inline-block;width:44px;height:6px;border-radius:6px;background:#2e3850}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px}
  .group{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  label{font-size:12px;color:var(--muted)}
  input[type="range"]{width:140px}
  button,.chip{background:#0f1420;border:1px solid var(--line);color:var(--fg);padding:8px 10px;border-radius:12px;font-weight:600;letter-spacing:.2px}
  button:hover{border-color:var(--accent)} .chip{font-size:12px}
  .accent{border-color:var(--accent)} .danger{border-color:var(--danger);color:#ffdada}
  .divider{height:1px;background:var(--line);margin:0 10px}
  details{border:1px solid var(--line);border-radius:12px;margin:10px;padding:8px}
  summary{cursor:pointer;font-weight:700}
  details .col{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
  #status{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:60;background:rgba(0,0,0,.55);padding:8px 12px;border-radius:12px;border:1px solid var(--line);font-size:12px;display:none}
  #showTab{position:fixed;top:10px;right:12px;z-index:70;background:rgba(0,0,0,.6);border:1px solid var(--line);border-radius:999px;padding:8px 10px;font-weight:700;display:none}
  @media (max-width:640px){input[type="range"]{width:120px}}
</style>
</head>
<body>
  <canvas id="view"></canvas>

  <!-- Hidden media sources -->
  <video id="vidA" playsinline muted loop style="display:none"></video>
  <img   id="imgA" alt="" style="display:none"/>
  <video id="vidB" playsinline muted loop style="display:none"></video>
  <img   id="imgB" alt="" style="display:none"/>
  <input id="fileA" type="file" accept="image/*,video/*" style="display:none"/>
  <input id="fileB" type="file" accept="image/*,video/*" style="display:none"/>

  <!-- Dock -->
  <div id="dock">
    <div id="dragbar">
      <span class="grab" title="Drag panel"></span>
      <div style="display:flex;gap:8px;align-items:center;margin-left:auto">
        <button id="dockPos">Dock: Top</button>
        <button id="hide">Hide (H)</button>
      </div>
    </div>

    <div class="row" style="justify-content:space-between">
      <div class="group">
        <button id="openA">Load Deck A</button>
        <button id="openB">Load Deck B</button>
        <button id="snapshot" title="Save PNG">Snapshot</button>
        <button id="rec" class="accent" title="Record WebM">● Record</button>
        <a id="dl" class="chip" href="#" download style="display:none">Download</a>
      </div>
      <div class="group">
        <a class="chip accent" href="https://cash.app/$lightwell333" target="_blank" rel="noopener">☘ Donate</a>
      </div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div class="group">
        <label>Wedges <span id="kVal">8</span></label>
        <input id="k" type="range" min="3" max="48" value="8" step="1"/>
        <label>Zoom <span id="zoomVal">1.00</span></label>
        <input id="zoom" type="range" min="0.3" max="5" step="0.01" value="1"/>
        <label>Rotate Speed <span id="rotVal">0.00</span></label>
        <input id="rot" type="range" min="-2" max="2" step="0.001" value="0"/>
        <label>Crossfader A⇄B <span id="mixVal">0.00</span></label>
        <input id="mix" type="range" min="0" max="1" step="0.001" value="0"/>
      </div>
    </div>

    <details open>
      <summary>Deck A — Visual Sculpt</summary>
      <div class="col">
        <label>Twist A <span id="twistAVal">0.00</span></label><input id="twistA" type="range" min="-5" max="5" step="0.01" value="0"/>
        <label>Bulge A <span id="bulgeAVal">0.00</span></label><input id="bulgeA" type="range" min="-1" max="1" step="0.01" value="0"/>
        <label>Ripple Amp A <span id="rAmpAVal">0.00</span></label><input id="rAmpA" type="range" min="0" max="0.5" step="0.001" value="0"/>
        <label>Ripple Freq A <span id="rFreqAVal">8.0</span></label><input id="rFreqA" type="range" min="1" max="30" step="0.1" value="8"/>
        <label>Ripple Speed A <span id="rSpdAVal">0.80</span></label><input id="rSpdA" type="range" min="-5" max="5" step="0.01" value="0.8"/>
        <label>Swirl A <span id="swirlAVal">0.00</span></label><input id="swirlA" type="range" min="-3" max="3" step="0.01" value="0"/>
        <label>Hue A <span id="hueAVal">0.00</span></label><input id="hueA" type="range" min="-1" max="1" step="0.001" value="0"/>
        <label>Sat A <span id="satAVal">1.00</span></label><input id="satA" type="range" min="0" max="2" step="0.01" value="1"/>
        <label>Gain A <span id="gainAVal">1.00</span></label><input id="gainA" type="range" min="0" max="3" step="0.01" value="1"/>
      </div>
    </details>

    <details>
      <summary>Deck B — Visual Sculpt</summary>
      <div class="col">
        <label>Twist B <span id="twistBVal">0.00</span></label><input id="twistB" type="range" min="-5" max="5" step="0.01" value="0"/>
        <label>Bulge B <span id="bulgeBVal">0.00</span></label><input id="bulgeB" type="range" min="-1" max="1" step="0.01" value="0"/>
        <label>Ripple Amp B <span id="rAmpBVal">0.00</span></label><input id="rAmpB" type="range" min="0" max="0.5" step="0.001" value="0"/>
        <label>Ripple Freq B <span id="rFreqBVal">8.0</span></label><input id="rFreqB" type="range" min="1" max="30" step="0.1" value="8"/>
        <label>Ripple Speed B <span id="rSpdBVal">0.80</span></label><input id="rSpdB" type="range" min="-5" max="5" step="0.01" value="0.8"/>
        <label>Swirl B <span id="swirlBVal">0.00</span></label><input id="swirlB" type="range" min="-3" max="3" step="0.01" value="0"/>
        <label>Hue B <span id="hueBVal">0.00</span></label><input id="hueB" type="range" min="-1" max="1" step="0.001" value="0"/>
        <label>Sat B <span id="satBVal">1.00</span></label><input id="satB" type="range" min="0" max="2" step="0.01" value="1"/>
        <label>Gain B <span id="gainBVal">1.00</span></label><input id="gainB" type="range" min="0" max="3" step="0.01" value="1"/>
      </div>
    </details>
  </div>

  <button id="showTab">Show Panel</button>
  <div id="status"></div>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const canvas = $('#view');
  const gl = canvas.getContext('webgl',{antialias:false,preserveDrawingBuffer:true});
  if(!gl){ alert('WebGL not available'); return; }

  // Resize (DPR-aware)
  function resize(){
    const dpr = Math.max(1, devicePixelRatio||1);
    const w = Math.floor(innerWidth*dpr), h = Math.floor(innerHeight*dpr);
    if(canvas.width!==w || canvas.height!==h){
      canvas.width=w; canvas.height=h; canvas.style.width='100vw'; canvas.style.height='100vh';
      gl.viewport(0,0,w,h);
    }
  }
  addEventListener('resize', resize, {passive:true}); resize();

  // UI basics
  const dock=$('#dock'), dragbar=$('#dragbar'), dockPosBtn=$('#dockPos'), hideBtn=$('#hide'), showTab=$('#showTab'), status=$('#status');
  function toast(m,ms=1200){status.textContent=m;status.style.display='block';clearTimeout(toast._t);toast._t=setTimeout(()=>status.style.display='none',ms);}

  let dragging=false,oX=0,oY=0;
  dragbar.addEventListener('pointerdown',e=>{dragging=true;dragbar.style.cursor='grabbing';const r=dock.getBoundingClientRect();dock.style.left=r.left+'px';dock.style.top=r.top+'px';dock.style.transform='none';oX=e.clientX-r.left;oY=e.clientY-r.top;dragbar.setPointerCapture(e.pointerId);});
  dragbar.addEventListener('pointermove',e=>{if(!dragging)return;let x=e.clientX-oX,y=e.clientY-oY;x=Math.max(10,Math.min(innerWidth-dock.offsetWidth-10,x));y=Math.max(10,Math.min(innerHeight-60,y));dock.style.left=x+'px';dock.style.top=y+'px';});
  const endDrag=()=>{dragging=false;dragbar.style.cursor='grab';}; dragbar.addEventListener('pointerup',endDrag); dragbar.addEventListener('pointercancel',endDrag);
  const positions=['Top','Bottom','Left','Right']; let posIdx=0;
  function applyDock(){
    dock.style.transform=''; dock.style.left=''; dock.style.top=''; dock.style.right=''; dock.style.bottom='';
    if(positions[posIdx]==='Top'){dock.style.left='50%';dock.style.top='10px';dock.style.transform='translateX(-50%)';dock.style.maxHeight='82vh';dock.style.width='auto';}
    else if(positions[posIdx]==='Bottom'){dock.style.left='50%';dock.style.bottom='10px';dock.style.transform='translateX(-50%)';dock.style.maxHeight='60vh';dock.style.width='auto';}
    else if(positions[posIdx]==='Left'){dock.style.left='10px';dock.style.top='50%';dock.style.transform='translateY(-50%)';dock.style.width='340px';dock.style.maxHeight='90vh';}
    else {dock.style.right='10px';dock.style.top='50%';dock.style.transform='translateY(-50%)';dock.style.width='340px';dock.style.maxHeight='90vh';}
    dockPosBtn.textContent='Dock: '+positions[posIdx];
  }
  dockPosBtn.onclick=()=>{posIdx=(posIdx+1)%positions.length;applyDock();}; applyDock();
  hideBtn.onclick=()=>{dock.style.display='none';showTab.style.display='block';};
  showTab.onclick=()=>{dock.style.display='block';showTab.style.display='none';};
  addEventListener('keydown',e=>{if(e.key==='h'||e.key==='H')hideBtn.click();});

  // Controls
  const kR=$('#k'),kVal=$('#kVal'),zoomR=$('#zoom'),zoomVal=$('#zoomVal'),rotR=$('#rot'),rotVal=$('#rotVal'),mixR=$('#mix'),mixVal=$('#mixVal');
  const A={twist:$('#twistA'),bulge:$('#bulgeA'),rAmp:$('#rAmpA'),rFreq:$('#rFreqA'),rSpd:$('#rSpdA'),swirl:$('#swirlA'),hue:$('#hueA'),sat:$('#satA'),gain:$('#gainA')};
  const B={twist:$('#twistB'),bulge:$('#bulgeB'),rAmp:$('#rAmpB'),rFreq:$('#rFreqB'),rSpd:$('#rSpdB'),swirl:$('#swirlB'),hue:$('#hueB'),sat:$('#satB'),gain:$('#gainB')};
  function sync(){
    kVal.textContent=kR.value; zoomVal.textContent=(+zoomR.value).toFixed(2); rotVal.textContent=(+rotR.value).toFixed(2); mixVal.textContent=(+mixR.value).toFixed(2);
    $('#twistAVal').textContent=(+A.twist.value).toFixed(2); $('#bulgeAVal').textContent=(+A.bulge.value).toFixed(2);
    $('#rAmpAVal').textContent=(+A.rAmp.value).toFixed(3); $('#rFreqAVal').textContent=(+A.rFreq.value).toFixed(1); $('#rSpdAVal').textContent=(+A.rSpd.value).toFixed(2);
    $('#swirlAVal').textContent=(+A.swirl.value).toFixed(2); $('#hueAVal').textContent=(+A.hue.value).toFixed(2); $('#satAVal').textContent=(+A.sat.value).toFixed(2); $('#gainAVal').textContent=(+A.gain.value).toFixed(2);
    $('#twistBVal').textContent=(+B.twist.value).toFixed(2); $('#bulgeBVal').textContent=(+B.bulge.value).toFixed(2);
    $('#rAmpBVal').textContent=(+B.rAmp.value).toFixed(3); $('#rFreqBVal').textContent=(+B.rFreq.value).toFixed(1); $('#rSpdBVal').textContent=(+B.rSpd.value).toFixed(2);
    $('#swirlBVal').textContent=(+B.swirl.value).toFixed(2); $('#hueBVal').textContent=(+B.hue.value).toFixed(2); $('#satBVal').textContent=(+B.sat.value).toFixed(2); $('#gainBVal').textContent=(+B.gain.value).toFixed(2);
  }
  [...document.querySelectorAll('input[type="range"]')].forEach(el=>el.addEventListener('input',sync)); sync();

  // Shaders
  const vsrc=`attribute vec2 a_pos;varying vec2 v_uv;void main(){v_uv=a_pos*0.5+0.5;gl_Position=vec4(a_pos,0.,1.);}`;
  const fsrc=`
    precision highp float;varying vec2 v_uv;
    uniform vec2 u_res;uniform float u_time;uniform float u_k;uniform float u_zoom;uniform float u_rotSpd;uniform float u_mix;
    uniform sampler2D u_texA;uniform bool u_hasA;uniform vec4 u_a1;uniform vec3 u_a2;uniform vec3 u_a3;
    uniform sampler2D u_texB;uniform bool u_hasB;uniform vec4 u_b1;uniform vec3 u_b2;uniform vec3 u_b3;
    mat2 r2(float a){float c=cos(a),s=sin(a);return mat2(c,-s,s,c);}
    vec3 grade(vec3 col, vec3 hsg){
      const mat3 YIQ=mat3(0.299,0.587,0.114, 0.596,-0.274,-0.322, 0.211,-0.523,0.312);
      const mat3 RGB=mat3(1.,0.956,0.621, 1.,-0.272,-0.647, 1.,-1.106,1.703);
      vec3 yiq=YIQ*col; float a=6.2831853*hsg.x; float C=cos(a),S=sin(a);
      yiq=mat3(1.,0.,0., 0.,C,-S, 0.,S,C)*yiq; col=RGB*yiq;
      float g=dot(col,vec3(0.299,0.587,0.114)); col=mix(vec3(g),col,hsg.y); col*=hsg.z; return col;
    }
    vec2 kaleido(vec2 uv,float k){float A=atan(uv.y,uv.x),r=length(uv),m=6.28318530718/k;A=mod(A,m);A=abs(A-m*.5);return vec2(cos(A),sin(A))*r;}
    vec2 sculpt(vec2 uv, vec4 p1, vec3 p2, float t){
      float twist=p1.x, bulge=p1.y, rAmp=p1.z, rFreq=p1.w; float rSpd=p2.x, swirl=p2.y;
      float r=length(uv), ang=atan(uv.y,uv.x);
      float br=r + bulge*r*r; float ripple=rAmp*sin(rFreq*br - t*rSpd*3.14159);
      float a=ang + twist*r + swirl*.5*r*r;
      return vec2(cos(a),sin(a))*(br + ripple);
    }
    vec3 deck(sampler2D tex,bool has,vec2 uv,vec4 p1,vec3 p2,vec3 p3,float t){
      vec2 suv=sculpt(uv,p1,p2,t); vec2 st=suv*.5+.5;
      vec3 col=vec3(.12+.12*sin(vec3(uv,uv.x+uv.y)*4.+t));
      if(has){ col=texture2D(tex,st).rgb; }
      return grade(col, vec3(p2.z,p3.x,p3.y));
    }
    void main(){
      vec2 uv=(v_uv-.5)*2.; float t=u_time; uv*=u_zoom; uv*=r2(t*u_rotSpd);
      uv=kaleido(uv,max(3.,u_k));
      vec3 a=deck(u_texA,u_hasA,uv,u_a1,u_a2,u_a3,t);
      vec3 b=deck(u_texB,u_hasB,uv,u_b1,u_b2,u_b3,t);
      vec3 col=mix(a,b,clamp(u_mix,0.,1.));
      col+=.08*sin(vec3(uv,uv.x+uv.y)*3.+t*1.5);
      gl_FragColor=vec4(col,1.);
    }`;

  function sh(t,src){const s=gl.createShader(t);gl.shaderSource(s,src);gl.compileShader(s);
    if(!gl.getShaderParameter(s,gl.COMPILE_STATUS)){console.error(gl.getShaderInfoLog(s));alert('Shader error');}return s;}
  const prog=gl.createProgram();
  gl.attachShader(prog,sh(gl.VERTEX_SHADER,vsrc)); gl.attachShader(prog,sh(gl.FRAGMENT_SHADER,fsrc));
  gl.linkProgram(prog); if(!gl.getProgramParameter(prog,gl.LINK_STATUS)){console.error(gl.getProgramInfoLog(prog));alert('Link error');}
  gl.useProgram(prog);

  // Quad
  const buf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,buf);
  gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),gl.STATIC_DRAW);
  const a_pos=gl.getAttribLocation(prog,'a_pos'); gl.enableVertexAttribArray(a_pos); gl.vertexAttribPointer(a_pos,2,gl.FLOAT,false,0,0);

  // Uniforms
  const u_time=gl.getUniformLocation(prog,'u_time'), u_res=gl.getUniformLocation(prog,'u_res');
  const u_k=gl.getUniformLocation(prog,'u_k'), u_zoom=gl.getUniformLocation(prog,'u_zoom');
  const u_rotSpd=gl.getUniformLocation(prog,'u_rotSpd'), u_mix=gl.getUniformLocation(prog,'u_mix');
  const u_texA=gl.getUniformLocation(prog,'u_texA'), u_hasA=gl.getUniformLocation(prog,'u_hasA');
  const u_texB=gl.getUniformLocation(prog,'u_texB'), u_hasB=gl.getUniformLocation(prog,'u_hasB');
  const u_a1=gl.getUniformLocation(prog,'u_a1'), u_a2=gl.getUniformLocation(prog,'u_a2'), u_a3=gl.getUniformLocation(prog,'u_a3');
  const u_b1=gl.getUniformLocation(prog,'u_b1'), u_b2=gl.getUniformLocation(prog,'u_b2'), u_b3=gl.getUniformLocation(prog,'u_b3');
  gl.uniform1i(u_texA,0); gl.uniform1i(u_texB,1);

  // NPOT-safe textures
  function makeTex(){
    const t=gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D,t);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);
    return t;
  }
  const texA=makeTex(), texB=makeTex(); let hasA=false,hasB=false;

  function uploadTo(tex, src){
    gl.bindTexture(gl.TEXTURE_2D,tex);
    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,true);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);
    gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,src);
  }

  const fileA=$('#fileA'),fileB=$('#fileB'),imgA=$('#imgA'),imgB=$('#imgB'),vidA=$('#vidA'),vidB=$('#vidB');
  function handleFile(file,which){
    if(!file)return;
    if(file.type.startsWith('image')){
      const img=which==='A'?imgA:imgB;
      img.onload=()=>{uploadTo(which==='A'?texA:texB,img);if(which==='A')hasA=true;else hasB=true;toast('Image → Deck '+which);}
      img.src=URL.createObjectURL(file);
    }else if(file.type.startsWith('video')){
      const vid=which==='A'?vidA:vidB;
      vid.src=URL.createObjectURL(file); vid.loop=true; vid.muted=true; vid.playsInline=true;
      vid.oncanplay=()=>{if(which==='A')hasA=true;else hasB=true;vid.play().catch(()=>{});toast('Video → Deck '+which);}
    }else{toast('Unsupported file');}
  }
  $('#openA').onclick=()=>fileA.click(); $('#openB').onclick=()=>fileB.click();
  fileA.onchange=e=>handleFile(e.target.files[0],'A'); fileB.onchange=e=>handleFile(e.target.files[0],'B');

  // Snapshot & Record
  $('#snapshot').onclick=()=>{const a=document.createElement('a');a.download='psyforge.png';a.href=canvas.toDataURL('image/png');a.click();};
  const recBtn=$('#rec'), dl=$('#dl'); let rec=null,chunks=[];
  recBtn.onclick=()=>{
    if(rec && rec.state==='recording'){rec.stop();return;}
    const stream=canvas.captureStream(30);
    rec=new MediaRecorder(stream,{mimeType:'video/webm'});
    rec.ondataavailable=e=>{if(e.data.size)chunks.push(e.data);};
    rec.onstop=()=>{const blob=new Blob(chunks,{type:'video/webm'});chunks=[];const url=URL.createObjectURL(blob);dl.href=url;dl.download='psyforge.webm';dl.style.display='inline-block';recBtn.textContent='● Record';toast('Recording ready — Download');};
    rec.start(); recBtn.textContent='■ Stop'; dl.style.display='none';
  };

  // Render
  function f(v){return parseFloat(v);}
  let t0=performance.now();
  function frame(now){
    resize();
    const t=(now-t0)/1000;
    gl.uniform1f(u_time,t); gl.uniform2f(u_res,canvas.width,canvas.height);

    // stream video frames
    if(vidA.readyState>=2 && !vidA.paused && !vidA.ended){gl.activeTexture(gl.TEXTURE0);uploadTo(texA,vidA);}
    if(vidB.readyState>=2 && !vidB.paused && !vidB.ended){gl.activeTexture(gl.TEXTURE1);uploadTo(texB,vidB);}

    gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D,texA);
    gl.activeTexture(gl.TEXTURE1); gl.bindTexture(gl.TEXTURE_2D,texB);
    gl.uniform1i(u_hasA,hasA?1:0); gl.uniform1i(u_hasB,hasB?1:0);

    gl.uniform1f(u_k,f(kR.value)); gl.uniform1f(u_zoom,f(zoomR.value));
    gl.uniform1f(u_rotSpd,f(rotR.value)); gl.uniform1f(u_mix,f(mixR.value));

    gl.uniform4f(u_a1,f(A.twist.value),f(A.bulge.value),f(A.rAmp.value),f(A.rFreq.value));
    gl.uniform3f(u_a2,f(A.rSpd.value),f(A.swirl.value),f(A.hue.value));
    gl.uniform3f(u_a3,f(A.sat.value),f(A.gain.value),0.0);

    gl.uniform4f(u_b1,f(B.twist.value),f(B.bulge.value),f(B.rAmp.value),f(B.rFreq.value));
    gl.uniform3f(u_b2,f(B.rSpd.value),f(B.swirl.value),f(B.hue.value));
    gl.uniform3f(u_b3,f(B.sat.value),f(B.gain.value),0.0);

    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawArrays(gl.TRIANGLE_STRIP,0,4);
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
</script>
</body>
</html>
