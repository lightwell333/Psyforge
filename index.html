<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Canvas Recorder — Minimal Test</title>
<style>
  html,body{margin:0;height:100%;background:#0b0f16;color:#eaf4ff;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #app{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
  canvas{width:92vw;height:60vh;max-width:1200px;display:block;border-radius:12px;background:#000;border:1px solid #223}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  button,a{background:#131b2b;color:#eaf4ff;border:1px solid #2a3246;padding:8px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
  button:hover,a:hover{border-color:#77f0ff}
  #status{color:#9db2d6;font-size:12px}
</style>
</head>
<body>
<div id="app">
  <h1 style="margin:8px 0 0">Canvas Recorder — Minimal Test</h1>
  <div id="status">Ready.</div>
  <canvas id="c"></canvas>
  <div class="row">
    <button id="recBtn">● Record</button>
    <a id="saveBtn" download="recording.webm" style="display:none">⬇︎ Save Video</a>
    <a id="openBtn" target="_blank" style="display:none">↗ Open in Tab</a>
    <button id="snapBtn">Snapshot PNG</button>
  </div>
</div>
<script>
(function(){
  const canvas = document.getElementById('c');
  const status = (m)=>document.getElementById('status').textContent=m;
  const recBtn = document.getElementById('recBtn');
  const saveBtn = document.getElementById('saveBtn');
  const openBtn = document.getElementById('openBtn');
  const snapBtn = document.getElementById('snapBtn');

  // Size canvas to device pixels
  const dpr = Math.min(2, window.devicePixelRatio||1);
  function resize(){ const w=Math.floor(innerWidth*0.92*dpr), h=Math.floor(innerHeight*0.60*dpr); if(canvas.width!==w||canvas.height!==h){ canvas.width=w; canvas.height=h; } }
  addEventListener('resize', resize, {passive:true}); resize();

  // SUPER SIMPLE ANIMATION (so you can see recording works)
  const ctx = canvas.getContext('2d');
  let t0 = performance.now();
  let x=40, y=40, vx=140, vy=110, r=28;
  function draw(){
    const t = performance.now(); const dt = (t - t0)/1000; t0 = t;
    x += vx*dt; y += vy*dt;
    if(x<r||x>canvas.width-r) vx*=-1, x=Math.max(r, Math.min(canvas.width-r,x));
    if(y<r||y>canvas.height-r) vy*=-1, y=Math.max(r, Math.min(canvas.height-r,y));
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // background pulse
    const pulse = (Math.sin(t*0.002)*0.5+0.5)*20|0; ctx.fillStyle = `rgb(${pulse},${pulse},${pulse})`; ctx.fillRect(0,0,canvas.width,canvas.height);
    // ball
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle='#77f0ff'; ctx.fill();
    requestAnimationFrame(draw);
  }
  draw();

  // SNAPSHOT
  snapBtn.onclick = ()=>{ const a=document.createElement('a'); a.download='frame.png'; a.href=canvas.toDataURL('image/png'); a.click(); };

  // RECORDING
  let recorder=null, chunks=[], blobUrl=null;
  function makeRecorder(){
    if(!canvas.captureStream){ status('This browser does not support canvas.captureStream. Try Chrome/Edge/Firefox desktop.'); return null; }
    const stream = canvas.captureStream(60);
    const types = [ 'video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/webm' ];
    let r=null; for(const t of types){ try{ r = new MediaRecorder(stream, { mimeType:t }); break; } catch(_){} }
    if(!r){ status('MediaRecorder not supported with WebM here (Safari/iOS usually).'); return null; }
    return r;
  }

  recBtn.onclick = () => {
    if(!recorder){
      recorder = makeRecorder(); if(!recorder) return;
      chunks = []; if(blobUrl){ URL.revokeObjectURL(blobUrl); blobUrl=null; saveBtn.style.display=openBtn.style.display='none'; }
      recorder.ondataavailable = (e)=>{ if(e.data && e.data.size>0) chunks.push(e.data); };
      recorder.onstop = ()=>{
        const blob = new Blob(chunks, { type:'video/webm' });
        blobUrl = URL.createObjectURL(blob);
        saveBtn.href = blobUrl; openBtn.href = blobUrl;
        saveBtn.style.display = openBtn.style.display = 'inline-block';
        status('Recording complete. Use ⬇︎ Save Video to download.');
      };
      recorder.start();
      recBtn.textContent = '■ Stop';
      status('Recording…');
    } else {
      recorder.stop(); recorder=null;
      recBtn.textContent = '● Record';
    }
  };

  // NICE-TO-HAVE: warn Safari users
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  if(isSafari){ status('Safari may not support MediaRecorder WebM. Use Chrome/Edge/Firefox to record.'); }
})();
</script>
</body>
</html>
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Canvas Recorder — Minimal Test</title>
<style>
  html,body{margin:0;height:100%;background:#0b0f16;color:#eaf4ff;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #app{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
  canvas{width:92vw;height:60vh;max-width:1200px;display:block;border-radius:12px;background:#000;border:1px solid #223}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  button,a{background:#131b2b;color:#eaf4ff;border:1px solid #2a3246;padding:8px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
  button:hover,a:hover{border-color:#77f0ff}
  #status{color:#9db2d6;font-size:12px}
</style>
</head>
<body>
<div id="app">
  <h1 style="margin:8px 0 0">Canvas Recorder — Minimal Test</h1>
  <div id="status">Ready.</div>
  <canvas id="c"></canvas>
  <div class="row">
    <button id="recBtn">● Record</button>
    <a id="saveBtn" download="recording.webm" style="display:none">⬇︎ Save Video</a>
    <a id="openBtn" target="_blank" style="display:none">↗ Open in Tab</a>
    <button id="snapBtn">Snapshot PNG</button>
  </div>
</div>
<script>
(function(){
  const canvas = document.getElementById('c');
  const status = (m)=>document.getElementById('status').textContent=m;
  const recBtn = document.getElementById('recBtn');
  const saveBtn = document.getElementById('saveBtn');
  const openBtn = document.getElementById('openBtn');
  const snapBtn = document.getElementById('snapBtn');

  // Size canvas to device pixels
  const dpr = Math.min(2, window.devicePixelRatio||1);
  function resize(){ const w=Math.floor(innerWidth*0.92*dpr), h=Math.floor(innerHeight*0.60*dpr); if(canvas.width!==w||canvas.height!==h){ canvas.width=w; canvas.height=h; } }
  addEventListener('resize', resize, {passive:true}); resize();

  // SUPER SIMPLE ANIMATION (so you can see recording works)
  const ctx = canvas.getContext('2d');
  let t0 = performance.now();
  let x=40, y=40, vx=140, vy=110, r=28;
  function draw(){
    const t = performance.now(); const dt = (t - t0)/1000; t0 = t;
    x += vx*dt; y += vy*dt;
    if(x<r||x>canvas.width-r) vx*=-1, x=Math.max(r, Math.min(canvas.width-r,x));
    if(y<r||y>canvas.height-r) vy*=-1, y=Math.max(r, Math.min(canvas.height-r,y));
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // background pulse
    const pulse = (Math.sin(t*0.002)*0.5+0.5)*20|0; ctx.fillStyle = `rgb(${pulse},${pulse},${pulse})`; ctx.fillRect(0,0,canvas.width,canvas.height);
    // ball
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle='#77f0ff'; ctx.fill();
    requestAnimationFrame(draw);
  }
  draw();

  // SNAPSHOT
  snapBtn.onclick = ()=>{ const a=document.createElement('a'); a.download='frame.png'; a.href=canvas.toDataURL('image/png'); a.click(); };

  // RECORDING
  let recorder=null, chunks=[], blobUrl=null;
  function makeRecorder(){
    if(!canvas.captureStream){ status('This browser does not support canvas.captureStream. Try Chrome/Edge/Firefox desktop.'); return null; }
    const stream = canvas.captureStream(60);
    const types = [ 'video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/webm' ];
    let r=null; for(const t of types){ try{ r = new MediaRecorder(stream, { mimeType:t }); break; } catch(_){} }
    if(!r){ status('MediaRecorder not supported with WebM here (Safari/iOS usually).'); return null; }
    return r;
  }

  recBtn.onclick = () => {
    if(!recorder){
      recorder = makeRecorder(); if(!recorder) return;
      chunks = []; if(blobUrl){ URL.revokeObjectURL(blobUrl); blobUrl=null; saveBtn.style.display=openBtn.style.display='none'; }
      recorder.ondataavailable = (e)=>{ if(e.data && e.data.size>0) chunks.push(e.data); };
      recorder.onstop = ()=>{
        const blob = new Blob(chunks, { type:'video/webm' });
        blobUrl = URL.createObjectURL(blob);
        saveBtn.href = blobUrl; openBtn.href = blobUrl;
        saveBtn.style.display = openBtn.style.display = 'inline-block';
        status('Recording complete. Use ⬇︎ Save Video to download.');
      };
      recorder.start();
      recBtn.textContent = '■ Stop';
      status('Recording…');
    } else {
      recorder.stop(); recorder=null;
      recBtn.textContent = '● Record';
    }
  };

  // NICE-TO-HAVE: warn Safari users
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  if(isSafari){ status('Safari may not support MediaRecorder WebM. Use Chrome/Edge/Firefox to record.'); }
})();
</script>
</body>
</html>
